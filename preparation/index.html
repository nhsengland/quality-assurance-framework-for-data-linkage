
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../triage/" rel="prev"/>
<link href="../implementation/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.1.21" name="generator"/>
<title>Data preparation - Quality Assurance Framework for Data Linkage</title>
<link href="../assets/stylesheets/main.eebd395e.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.ecc896b0.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../assets/_markdown_exec_ansi.css" rel="stylesheet"/>
<link href="../assets/stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#data-preparation">3. 
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Quality Assurance Framework for Data Linkage" class="md-header__button md-logo" data-md-component="logo" href=".." title="Quality Assurance Framework for Data Linkage">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Quality Assurance Framework for Data Linkage
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Data preparation
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-hidden="true" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../quality-assurance-framework/introduction/">
      Framework intro
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../triage/">
      Triage
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="./">
      Data preparation
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../implementation/">
      Implementation
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../evaluation/">
      Evaluation
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../overall-considerations/">
      Overall considerations
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../team-intro/">
      About us
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../glossary/">
      Glossary
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden="">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Quality Assurance Framework for Data Linkage" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Quality Assurance Framework for Data Linkage">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Quality Assurance Framework for Data Linkage
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../quality-assurance-framework/introduction/">
        Framework intro
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../triage/">
        Triage
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Data preparation
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Data preparation
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#profiling">3.1 
    Profiling
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#assessment">3.2 
    Assessment
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#enrichment">3.3 
    Enrichment
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../implementation/">
        Implementation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../evaluation/">
        Evaluation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../overall-considerations/">
        Overall considerations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../team-intro/">
        About us
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../glossary/">
        Glossary
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#profiling">3.1 
    Profiling
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#assessment">3.2 
    Assessment
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#enrichment">3.3 
    Enrichment
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="data-preparation"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.</span> Data preparation</h1>
<h2 id="profiling"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.1</span> Profiling</h2>
<p>Data profiling is the process of examining the data and collecting statistics and information about that data.
This is important for selecting the right blocking and matching variables and ensure accurate linkage results.</p>
<div class="admonition info">
<p class="admonition-title">Data Profiling</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><input id="__tabbed_1_3" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">Recommendations</label><label for="__tabbed_1_2">RAG</label><label for="__tabbed_1_3">Worked examples</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>This includes establishing:</p>
<ul>
<li>Data dictionary (data types, data meaning, etc)</li>
<li>Completeness (presence of missing or null values)</li>
<li>Uniqueness / cardinality (how many and which unique values a variable can have)</li>
<li>Validity of variable values (the values are included in the data dictionary, are valid, have a meaning)</li>
<li>Distribution of values / outliers</li>
<li>Basic statistics (min, max, mean, variance)</li>
<li>Correlations and functional dependencies between variables</li>
</ul>
</div>
<div class="tabbed-block">
<p>🔴 <strong>RED:</strong> <br/>
No data profiling is performed before linking, leading to potential inconsistencies in the linked data.</p>
<p>🟡 <strong>AMBER:</strong> <br/>
Some data profiling is performed before linking, but it could be more thorough and systematic.</p>
<p>🟢 <strong>GREEN:</strong> <br/>
Comprehensive data profiling is performed before linking, identifying and resolving inconsistencies in datasets to be linked.</p>
</div>
<div class="tabbed-block">
<details>
<summary>Data Dictionary Creation</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">input_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name'</span><span class="p">]]</span>
<span class="n">input_schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'dob'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]</span>
<span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">input_schema</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_data_types</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    function to get data types of columns in a dataframe</span>

<span class="sd">    parameters:</span>
<span class="sd">        df: Input DataFrame</span>

<span class="sd">    returns:</span>
<span class="sd">        DataFrame: DataFrame with columns 'Column' and 'Data Type'</span>
<span class="sd">    '''</span>

    <span class="n">data_types</span> <span class="o">=</span> <span class="p">[[</span><span class="n">col_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_type</span><span class="p">)]</span> <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">col_type</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)]</span>

    <span class="n">schema</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">'Column'</span><span class="p">,</span> <span class="s1">'Data Type'</span><span class="p">]</span>

    <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_types</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">schema</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result_df</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">get_data_types</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">  Column Data Type</span>
<span class="go">0     id     int64</span>
<span class="go">1    dob     int64</span>
<span class="go">2   name    object</span>
</code></pre></div><div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Completeness</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">input_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name'</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name'</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
<span class="n">input_schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'dob'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]</span>
<span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">input_schema</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">null_percentage</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Function to calculate the percentage of null values in each column of a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        df (DataFrame): Input DataFrame</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: DataFrame with columns 'Column' and 'Null Percentage'</span>
<span class="sd">    '''</span>

    <span class="n">total_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">null_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">null_percentages</span> <span class="o">=</span> <span class="p">(</span><span class="n">null_counts</span> <span class="o">/</span> <span class="n">total_rows</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Column'</span><span class="p">:</span> <span class="n">null_percentages</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">'Null Percentage'</span><span class="p">:</span> <span class="n">null_percentages</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">result_df</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">null_percentage</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">  Column  Null Percentage</span>
<span class="go">0     id             25.0</span>
<span class="go">1    dob              0.0</span>
<span class="go">2   name             50.0</span>
</code></pre></div><div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Uniqueness</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">input_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name'</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name2'</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
<span class="n">input_schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'dob'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]</span>
<span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">input_schema</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">uniqueness</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Function to calculate the uniqueness of values in each column of a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        df (DataFrame): Input DataFrame</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: DataFrame with columns 'Column' and 'Uniqueness'</span>
<span class="sd">    '''</span>
    <span class="n">unique_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
    <span class="n">total_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">uniqueness_percentages</span> <span class="o">=</span> <span class="p">(</span><span class="n">unique_counts</span> <span class="o">/</span> <span class="n">total_rows</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Column'</span><span class="p">:</span> <span class="n">uniqueness_percentages</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">'# of Unique Values'</span><span class="p">:</span> <span class="n">unique_counts</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">result_df</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">uniqueness</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">     Column  # of Unique Values</span>
<span class="go">id       id                   3</span>
<span class="go">dob     dob                   1</span>
<span class="go">name   name                   2</span>
</code></pre></div><div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Cardinality</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">input_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name'</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name2'</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="s1">'sample_name2'</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20240224</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
<span class="n">input_schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'dob'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]</span>
<span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">input_schema</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cardinality</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Function to calculate find what values a variable can have and how many times they appear each.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        df (DataFrame): Input DataFrame</span>
<span class="sd">        column_name (str): name of the column that you want to know the cardinality of.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: DataFrame with columns 'Value' and 'Count'</span>
<span class="sd">    '''</span>
    <span class="n">value_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">value_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_name</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">value_counts</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">cardinality</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">           name  count</span>
<span class="go">0  sample_name2      2</span>
<span class="go">1   sample_name      1</span>
</code></pre></div><div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Basic Stats</summary>
<p><div class="highlight"><span class="filename">Uniqueness</span><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">input_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'john'</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">51</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'lucy'</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">103</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="s1">'claire'</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">87</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'sam'</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">70</span><span class="p">]]</span>
<span class="n">input_schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">,</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'weight'</span><span class="p">]</span>
<span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">input_schema</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">basic_stats</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Function to calculate the basic stats of values in each numerical column of a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        df (DataFrame): Input DataFrame</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: DataFrame with columns 'Column', 'Mean', 'Median', 'Mode', 'Standard Deviation', 'Minimum', 'Maximum'</span>
<span class="sd">    '''</span>
    <span class="n">numerical_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">'number'</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">numerical_columns</span><span class="p">:</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">column</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">])</span>

    <span class="n">schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'column_name'</span><span class="p">,</span> <span class="s1">'mean'</span><span class="p">,</span> <span class="s1">'median'</span><span class="p">,</span> <span class="s1">'std'</span><span class="p">,</span> <span class="s1">'min'</span><span class="p">,</span> <span class="s1">'max'</span><span class="p">]</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">schema</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stats</span>



<span class="n">output</span> <span class="o">=</span> <span class="n">basic_stats</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">  column_name   mean  median        std  min  max</span>
<span class="go">0          id   2.50     2.5   1.290994    1    4</span>
<span class="go">1         age  35.00    33.5  17.454703   18   55</span>
<span class="go">2      weight  77.75    78.5  22.351361   51  103</span>
</code></pre></div><div class="markdown-exec"></div>
</p>
</details>
</div>
</div>
</input></input></input></div>
</div>
<h2 id="assessment"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.2</span> Assessment</h2>
<p>Assessing the findings from data profiling means using that information to evaluate if the input data is fit for linkage purposes, and how the data profile affect the modelling choices for linkage.</p>
<div class="admonition info">
<p class="admonition-title">Data assessment</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><input id="__tabbed_2_3" name="__tabbed_2" type="radio"/><div class="tabbed-labels"><label for="__tabbed_2_1">Recommendations</label><label for="__tabbed_2_2">RAG</label><label for="__tabbed_2_3">Worked examples</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>This includes (but it is not limited to):</p>
<ul>
<li>Assessing if variables have inconsistent values across data sets, and how to address this issue</li>
<li>Deciding which variables are most suitable to be used as blocking variables and for distance calculations, considering completeness, quality and validity</li>
<li>Decide which variables to use if there are multiple variables carrying similar information (i.e. correlated)</li>
</ul>
</div>
<div class="tabbed-block">
<p>🔴 <strong>RED:</strong> <br/>
Data profiling results have not been assessed. There has been no effort to evaluate the input data for its suitability for linkage purposes. There is no consideration given to the consistency of variables across datasets, the selection of suitable blocking variables, or the handling of correlated variables.</p>
<p>🟡 <strong>AMBER:</strong> <br/>
Some level of data assessment has been conducted, but it is incomplete or inconsistent. There may be efforts to evaluate certain aspects of the data, such as identifying inconsistent variable values or selecting blocking variables, but these assessments are not comprehensive.</p>
<p>🟢 <strong>GREEN:</strong> <br/>
A rigorous assessment was carried out. Findings are documented and inform subsequent decisions on the linkage methods.</p>
</div>
<div class="tabbed-block">
<details>
<summary>Profiling Assessment</summary>
<p><div class="highlight"><pre><span></span><code><span class="go">Table 1</span>
<span class="go">   gender  count</span>
<span class="go">0       1   2238</span>
<span class="go">1       2   1500</span>
<span class="go">2       9    387</span>
<span class="go">3       0    100</span>


<span class="go">Table 2</span>
<span class="go">   gender  count</span>
<span class="go">0       1   2555</span>
<span class="go">1       2   3002</span>
<span class="go">2       0    233</span>
</code></pre></div>
In this case, table 1 that you are trying to link to table 2 has 4 possible values for gender, whereas table 2 only has 3. It is possible that this is a sign that "Other" genders are saved in several categories in one table and in less in the other table. When linking this may mean that you have to consider 0 or 9 in table 1 to be a match with 0 in table 2.<div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Blocking Rules Assessment</summary>
<p><div class="highlight"><pre><span></span><code><span class="go">       column Null percentage</span>
<span class="go">0  given_name             10%</span>
<span class="go">1      gender              1%</span>
<span class="go">2    postcode             30%</span>
</code></pre></div>
In this case, using postcode as a blocking rule may not be appropriate, as due to such low data completeness in the column you might be blocking out records that are the correct match. Given name or gender may be more appropriate, though consideration of the low uniqueness of gender may make it less appropriate.<div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Correlated Values Assessment</summary>
<p><div class="highlight"><pre><span></span><code><span class="go">   Unique_ID            street postcode outcode   city</span>
<span class="go">0          1   Portland Street   LS31BL     LS3  Leeds</span>
<span class="go">1          2  Wellington Place   LS14AP     LS1  Leeds</span>
</code></pre></div>
In this case, the different address columns are correlated, as they should all work together to get a consistent address. However, for the person with Unique_ID equal to 1, their street name does not align with their postcode, so one of them would be wrong. You need to consider whether you would use just one column for linking on address (e.g. just the postcode) or a hierarchy of the different columns, for example, if postcode does not match, but outcode and street do, how would you consider this?<div class="markdown-exec"></div>
</p>
</details>
</div>
</div>
</input></input></div>
</div>
<h2 id="enrichment"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.3</span> Enrichment</h2>
<p>Data enrichment is the process of enhancing the quality and usefulness of data for data linkage. It involves transforming, standardising, filtering, and cleaning the data to optimise its value.</p>
<div class="admonition info">
<p class="admonition-title">Data enrichment</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"/><input id="__tabbed_3_2" name="__tabbed_3" type="radio"/><input id="__tabbed_3_3" name="__tabbed_3" type="radio"/><div class="tabbed-labels"><label for="__tabbed_3_1">Recommendations</label><label for="__tabbed_3_2">RAG</label><label for="__tabbed_3_3">Worked examples</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Transform: Create derived variables, recode categories, adjust formats, reshape data structures to ensure compatibility.</li>
<li>Standardise: Convert formats (dates, text case), map variable categories, address recording inconsistencies by applying standardisation techniques.</li>
<li>Exclude: Protect privacy and accuracy by removing sensitive data, national data opt-outs, and irrelevant fields.</li>
<li>Clean: Identify and correct errors, missing values, inconsistencies, and outliers.</li>
</ul>
<p>Document the results of data transformations and standardisation to maintain transparency and reproducibility.</p>
</div>
<div class="tabbed-block">
<p>🔴 <strong>RED:</strong> <br/>
There is no structured approach for data transformation.
If transformations have been applied, they are scattered in the code, and have not been identified or documented.
No efforts have been made to identify and exclude some sensitive, irrelevant or incorrect data.</p>
<p>🟡 <strong>AMBER:</strong> <br/>
While basic procedures for data transformation are in place, they aren't comprehensive.
Some standardised practices can be observed, but partially documented.
Efforts have been made to identify and exclude some sensitive, irrelevant or incorrect data, but the approach lacks comprehensiveness.</p>
<p>🟢 <strong>GREEN:</strong> <br/>
Data is systematically reviewed for the need of being transformed, standardised, filtered and cleansed.
The processes are documented and identified in the code.</p>
</div>
<div class="tabbed-block">
<details>
<summary>Transform gender values</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">gender_untransformed_schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'patient_id'</span><span class="p">,</span> <span class="s1">'gender'</span><span class="p">]</span>

<span class="n">untransformed_gender_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1</span><span class="p">],[</span><span class="mi">1002</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="mi">1003</span><span class="p">,</span> <span class="mi">2</span><span class="p">],[</span><span class="mi">1004</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1005</span><span class="p">,</span> <span class="mi">1</span><span class="p">],[</span><span class="mi">1006</span><span class="p">,</span> <span class="mi">9</span><span class="p">],[</span><span class="mi">1007</span><span class="p">,</span> <span class="mi">2</span><span class="p">],[</span><span class="mi">1008</span><span class="p">,</span><span class="mi">9</span><span class="p">]]</span>
<span class="n">untransformed_gender_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">untransformed_gender_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">gender_untransformed_schema</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">transform_gender_formatting</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column_to_standardise</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Converts encodings of 9 as 'unknown' for gender to 0</span>
<span class="sd">    '''</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'transformed_gender'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column_to_standardise</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>

<span class="n">transformed_df</span> <span class="o">=</span> <span class="n">transform_gender_formatting</span><span class="p">(</span><span class="n">untransformed_gender_df</span><span class="p">,</span> <span class="s1">'gender'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Untransformed gender"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">untransformed_gender_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">transformed_df</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">Untransformed gender</span>
<span class="go">   patient_id  gender  transformed_gender</span>
<span class="go">0        1001       1                   1</span>
<span class="go">1        1002       0                   0</span>
<span class="go">2        1003       2                   2</span>
<span class="go">3        1004       1                   1</span>
<span class="go">4        1005       1                   1</span>
<span class="go">5        1006       9                   0</span>
<span class="go">6        1007       2                   2</span>
<span class="go">7        1008       9                   0</span>


<span class="go">   patient_id  gender  transformed_gender</span>
<span class="go">0        1001       1                   1</span>
<span class="go">1        1002       0                   0</span>
<span class="go">2        1003       2                   2</span>
<span class="go">3        1004       1                   1</span>
<span class="go">4        1005       1                   1</span>
<span class="go">5        1006       9                   0</span>
<span class="go">6        1007       2                   2</span>
<span class="go">7        1008       9                   0</span>
</code></pre></div><div class="markdown-exec"></div>
</p>
<p>In this example, a decision was made to standardise the gender encodings of '9' of unknown to '0' which codes to unspecified, of which there were some pre-existing values in the table. This standardisation could happen if there are multiple encodings for 'other' in one table, but only one mapping of 'other' in another.</p>
</details>
<details>
<summary>Standardise text case</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">names_unstandardised</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'patient_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]</span>

<span class="n">unstandardised_names_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1001</span><span class="p">,</span> <span class="s1">'alan'</span><span class="p">],[</span><span class="mi">1002</span><span class="p">,</span> <span class="s1">'BOB'</span><span class="p">],[</span><span class="mi">1003</span><span class="p">,</span> <span class="s1">'carla'</span><span class="p">],[</span><span class="mi">1004</span><span class="p">,</span><span class="s1">'David'</span><span class="p">],[</span><span class="mi">1005</span><span class="p">,</span> <span class="s1">'ERIC'</span><span class="p">],[</span><span class="mi">1006</span><span class="p">,</span> <span class="s1">'frances'</span><span class="p">],[</span><span class="mi">1007</span><span class="p">,</span> <span class="s1">'gReg'</span><span class="p">],[</span><span class="mi">1008</span><span class="p">,</span><span class="s1">'Hannah'</span><span class="p">]]</span>
<span class="n">unstandardised_names_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">unstandardised_names_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">names_unstandardised</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">standardise_name_formatting</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column_to_standardise</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Converts all text cases to upper case for names</span>
<span class="sd">    '''</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'standardised_name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column_to_standardise</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span>

<span class="n">standardised_df</span> <span class="o">=</span> <span class="n">standardise_name_formatting</span><span class="p">(</span><span class="n">unstandardised_names_df</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Unstandardised gender"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">unstandardised_names_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">standardised_df</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">Unstandardised gender</span>
<span class="go">   patient_id     name standardised_name</span>
<span class="go">0        1001     alan              ALAN</span>
<span class="go">1        1002      BOB               BOB</span>
<span class="go">2        1003    carla             CARLA</span>
<span class="go">3        1004    David             DAVID</span>
<span class="go">4        1005     ERIC              ERIC</span>
<span class="go">5        1006  frances           FRANCES</span>
<span class="go">6        1007     gReg              GREG</span>
<span class="go">7        1008   Hannah            HANNAH</span>


<span class="go">   patient_id     name standardised_name</span>
<span class="go">0        1001     alan              ALAN</span>
<span class="go">1        1002      BOB               BOB</span>
<span class="go">2        1003    carla             CARLA</span>
<span class="go">3        1004    David             DAVID</span>
<span class="go">4        1005     ERIC              ERIC</span>
<span class="go">5        1006  frances           FRANCES</span>
<span class="go">6        1007     gReg              GREG</span>
<span class="go">7        1008   Hannah            HANNAH</span>
</code></pre></div>
In this example, standardising the text case makes linkage easier as variations in capitalisations are removed so 'ALAN', 'alan' and 'Alan' would correctly be treated as the same name.<div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Exclude records for linkage by patient consent</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">patient_consent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'patient_id'</span><span class="p">,</span> <span class="s1">'consent'</span><span class="p">]</span>

<span class="n">unfiltered_patient_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1001</span><span class="p">,</span> <span class="kc">True</span><span class="p">],[</span><span class="mi">1002</span><span class="p">,</span> <span class="kc">True</span><span class="p">],[</span><span class="mi">1003</span><span class="p">,</span> <span class="kc">True</span><span class="p">],[</span><span class="mi">1004</span><span class="p">,</span><span class="kc">True</span><span class="p">],[</span><span class="mi">1005</span><span class="p">,</span> <span class="kc">False</span><span class="p">],[</span><span class="mi">1006</span><span class="p">,</span> <span class="kc">True</span><span class="p">],[</span><span class="mi">1007</span><span class="p">,</span> <span class="kc">True</span><span class="p">],[</span><span class="mi">1008</span><span class="p">,</span><span class="kc">True</span><span class="p">]]</span>
<span class="n">unfiltered_consent_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">unfiltered_patient_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">patient_consent</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">filter_to_consenting_patients</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">patient_consent_column</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Removes any patients who have not consented to be contacted from the linkage</span>
<span class="sd">    '''</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">patient_consent_column</span><span class="p">]]</span>

<span class="n">consenting_patients_df</span> <span class="o">=</span> <span class="n">filter_to_consenting_patients</span><span class="p">(</span><span class="n">unfiltered_consent_df</span><span class="p">,</span> <span class="s1">'consent'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Unfiltered patient consent table"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">unfiltered_consent_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Table of patients filtered to those who consent to their data being analysed"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">consenting_patients_df</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">Unfiltered patient consent table</span>
<span class="go">   patient_id  consent</span>
<span class="go">0        1001     True</span>
<span class="go">1        1002     True</span>
<span class="go">2        1003     True</span>
<span class="go">3        1004     True</span>
<span class="go">4        1005    False</span>
<span class="go">5        1006     True</span>
<span class="go">6        1007     True</span>
<span class="go">7        1008     True</span>


<span class="go">Table of patients filtered to those who consent to their data being analysed</span>
<span class="go">   patient_id  consent</span>
<span class="go">0        1001     True</span>
<span class="go">1        1002     True</span>
<span class="go">2        1003     True</span>
<span class="go">3        1004     True</span>
<span class="go">5        1006     True</span>
<span class="go">6        1007     True</span>
<span class="go">7        1008     True</span>
</code></pre></div>
In this example, the data is filtered so any patients who do not consent for their data to be used are removed from the cohort to be linked.<div class="markdown-exec"></div>
</p>
</details>
<details>
<summary>Clean null name values</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">name_uncleaned_schema</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'patient_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]</span>

<span class="n">uncleaned_name_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1001</span><span class="p">,</span> <span class="s1">'alan'</span><span class="p">],[</span><span class="mi">1002</span><span class="p">,</span> <span class="s1">'BOB'</span><span class="p">],[</span><span class="mi">1003</span><span class="p">,</span> <span class="s1">'carla'</span><span class="p">],[</span><span class="mi">1004</span><span class="p">,</span><span class="s1">'David'</span><span class="p">],[</span><span class="mi">1005</span><span class="p">,</span> <span class="kc">None</span><span class="p">],[</span><span class="mi">1006</span><span class="p">,</span> <span class="s1">'frances'</span><span class="p">],[</span><span class="mi">1007</span><span class="p">,</span> <span class="s1">'gReg'</span><span class="p">],[</span><span class="mi">1008</span><span class="p">,</span><span class="kc">None</span><span class="p">]]</span>
<span class="n">uncleaned_name_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">uncleaned_name_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">name_uncleaned_schema</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">clean_null_name_values</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column_to_standardise</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Converts encodings of null to 'unspecified'</span>
<span class="sd">    '''</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'cleaned_name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column_to_standardise</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">'Unspecified'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>

<span class="n">cleaned_df</span> <span class="o">=</span> <span class="n">clean_null_name_values</span><span class="p">(</span><span class="n">uncleaned_name_df</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Uncleaned name table"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uncleaned_name_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Cleaned name table"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cleaned_df</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="go">Uncleaned name table</span>
<span class="go">   patient_id     name cleaned_name</span>
<span class="go">0        1001     alan         alan</span>
<span class="go">1        1002      BOB          BOB</span>
<span class="go">2        1003    carla        carla</span>
<span class="go">3        1004    David        David</span>
<span class="go">4        1005     None  Unspecified</span>
<span class="go">5        1006  frances      frances</span>
<span class="go">6        1007     gReg         gReg</span>
<span class="go">7        1008     None  Unspecified</span>


<span class="go">Cleaned name table</span>
<span class="go">   patient_id     name cleaned_name</span>
<span class="go">0        1001     alan         alan</span>
<span class="go">1        1002      BOB          BOB</span>
<span class="go">2        1003    carla        carla</span>
<span class="go">3        1004    David        David</span>
<span class="go">4        1005     None  Unspecified</span>
<span class="go">5        1006  frances      frances</span>
<span class="go">6        1007     gReg         gReg</span>
<span class="go">7        1008     None  Unspecified</span>
</code></pre></div><div class="markdown-exec"></div>
</p>
<p>In this example, any null gender values are recoded to 'Unspecified'.</p>
</details>
</div>
</div>
</div>
</div>
<p>If you have any ideas or feedback you'd like to give the team, feel free to <a href="https://github.com/nhsengland/quality-assurance-framework-for-data-linkage/issues/new?assignees=&amp;labels=&amp;projects=&amp;template=send-feedback-on-the-quality-assurance-framework-for-data-linkage.md&amp;title=">contact us</a></p>
<hr/>
<div class="md-source-file">
<small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 20, 2024</span>
<br/>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 20, 2024</span>
</small>
</div>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Triage" class="md-footer__link md-footer__link--prev" href="../triage/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Triage
              </div>
</div>
</a>
<a aria-label="Next: Implementation" class="md-footer__link md-footer__link--next" href="../implementation/" rel="next">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Implementation
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top", "navigation.footer", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
<script src="../js/mkdocs-charts-plugin.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</body>
</html>